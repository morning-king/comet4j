<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Comet0.0.2测试</title>
		
        <script type="text/javascript" src="/lib/JS/JS.js">
        </script>
        <script type="text/javascript" src="/lib/JS/Observable.js">
        </script>
        <script type="text/javascript" src="/lib/JS/XMLHttpRequest.js">
        </script>
        <script type="text/javascript" src="/lib/JS/StreamingConnector.js">
        </script>
        <script type="text/javascript" src="/lib/JS/AJAX.js">
        </script>
		
		<script type="text/javascript" src="/lib/JS/EventEngine.js">
        </script>

        <script type="text/javascript">
        	var serverUrl = '/conn';
        	var connector;
        	function init(){
        		connector = new JS.StreamingConnector({
    				url :serverUrl,
    			});
        		connector.on({
    				beforeStart : function(url,con){
    					var str = 'beforeStart :'+new Date().toString()+'----<br>'+
    							'url :'+url+'<br>'+
    							'--------<br>';
    					document.getElementById('StreamingConnector_log').innerHTML+=str;
    				},
    				connected : function(url,cid,con,xhr){
    					var str = 'connected :'+new Date().toString()+'----<br>'+
    							'url :'+url+'<br>'+
    							'cid :'+cid+'<br>'+
    							'--------<br>';
    					document.getElementById('StreamingConnector_log').innerHTML+=str;

    				},
    				beforeStop : function(url,cid,con,xhr){
    					var str = 'beforeStop :'+new Date().toString()+'----<br>'+
    							'url :'+url+'<br>'+
    							'cid :'+cid+'<br>'+
    							'--------<br>';
    					document.getElementById('StreamingConnector_log').innerHTML+=str;

    				},
    				stop : function(url,cid,con,xhr){
    					var str = 'stop :'+new Date().toString()+'----<br>'+
    							'url :'+url+'<br>'+
    							'cid :'+cid+'<br>'+
    							'--------<br>';
    					document.getElementById('StreamingConnector_log').innerHTML+=str;

    				},
    				data : function(data,responseText,con,xhr){
    					var str = 'data :'+new Date().toString()+'----<br>'+
    							'data :'+responseText+'<br>'+
    							'--------<br>';
    					document.getElementById('StreamingConnector_log').innerHTML+=str;

    				}

    			});
    			connector._xhr.on({
    				readyStateChange : function(readyState,status,xhr){
    					var str = '----'+new Date().toString()+'----<br>'+
    							'readyState：'+readyState+'<br>'+
    							'status：'+status+'<br>'+
    							'responseText：'+xhr.responseText+'<br>'+
    							'--------';
    					document.getElementById('XMLHttpRequest_log').innerHTML+=str;
    				}
    			});
            }
			
			function log(str){
				
				try{
					d.scroll(0,d.scrollHeigh);
				}catch(e){}
			}
			
			
			function conn(){
				connector.start();
			}
			function stop(){
				connector.stop();
			}	
			function cl(){
				document.getElementById('XMLHttpRequest_log').innerHTML = '';		
				document.getElementById('StreamingConnector_log').innerHTML = '';

			}		
            //JS.EventEngine.start(serverUrl + '?action=conn');
        </script>
    </head>
    <body onload="init()">
    
    <table style="width: 100%">
		<tr>
			<td style="width:50%;">连接测试</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td style="" colspan="2">
			
				&nbsp;
				<input name="Reset2" type="button" onclick="conn();" value="连接" />
				<input name="Reset3" type="button" onclick="stop();" value="断开" />
				<input name="Reset4" type="button" onclick="cl();" value="清空" /></td>
		</tr>
		<tr>
			<td colspan="2">
				XMLHttpRequest onReadyStateChange Event ：<br />
				<div id="XMLHttpRequest_log" style="width:100%;height:150px;overflow:auto;border:1px navy solid;"></div>
			</td>
		</tr>
		<tr>
			<td colspan="2">
				StreamingConnector
				Events ：</td>
		</tr>
		<tr>
			<td colspan="2">
				<div id="StreamingConnector_log" style="width:100%;height:150px;overflow:auto;border:1px navy solid;"></div>
			</td>
		</tr>
		<tr>
			<td colspan="2">
				问题：</td>
		</tr>
		<tr>
			<td colspan="2">
				IE下连接、断开、再连接就连接不上。<br />
				当服务器关掉以后FireFox无法正常触发stop事件。</td>
		</tr>
	</table>
    
    </body>
</html>
